Bootstrap: docker
From: python:3.9

%post
    # Install system dependencies and R
    apt-get update && apt-get install -y \
        r-base \
        r-base-dev \
        libcurl4-gnutls-dev \
        libxml2-dev \
        libssl-dev \
        libfontconfig1-dev \
        libharfbuzz-dev \
        libfribidi-dev \
        libfreetype6-dev \
        libpng-dev \
        libtiff5-dev \
        libjpeg-dev \
        git

    # Clone the repository
    git clone https://github.com/Christofferfrisk/rnalys.git /app
    cd /app

    # Install Python dependencies in a specific order to resolve conflicts
    pip install --no-cache-dir pandas==1.4.0
    pip install --no-cache-dir numpy==1.23.5
    pip install --no-cache-dir dash-bio==1.0.2
    pip install --no-cache-dir statsmodels==0.13.5
    
    # Now install the rest of the requirements, ignoring the conflicting versions
    pip install --no-cache-dir -r requirements.txt --no-deps
    
    # Install potentially missing dependencies
    pip install --no-cache-dir \
        dash==2.9.3 \
        plotly==5.13.1 \
        scipy==1.10.1 \
        scikit-learn==1.2.2

    # Install R packages
    Rscript install_packages.R

%startscript
    cd /app
    python app.py --host 0.0.0.0

%environment
    export PORT=8050

%labels
    Author Maintainer
    Version v1.0

%help
      Created based on the installation instructions on the original repo and Claude 3.5 Sonnet
